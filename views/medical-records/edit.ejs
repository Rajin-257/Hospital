<div class="row">
    <div class="col-md-10 mx-auto">
        <div class="card shadow">
            <div class="card-body">
                <h2 class="card-title mb-4">Edit Medical Record</h2>
                <form action="/medical-records/<%= medicalRecord.id %>?_method=PUT" method="POST">
                    <!-- Patient Information -->
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Patient Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Name:</strong> <%= medicalRecord.Patient.firstName %> <%= medicalRecord.Patient.lastName %></p>
                                    <p><strong>Patient ID:</strong> <%= medicalRecord.Patient.patientId %></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Visit Date:</strong> <%= new Date(medicalRecord.visitDate).toLocaleDateString() %></p>
                                </div>
                            </div>
                            <input type="hidden" name="patientId" value="<%= medicalRecord.patientId %>">
                        </div>
                    </div>
                    
                    <!-- Medical Information -->
                    <div class="card mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Medical Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="doctorId" class="form-label">Attending Doctor</label>
                                <select class="form-select" id="doctorId" name="doctorId" required>
                                    <option value="">Select a doctor</option>
                                    <% doctors.forEach(doctor => { %>
                                        <option value="<%= doctor.id %>" <%= doctor.id === medicalRecord.doctorId ? 'selected' : '' %>>
                                            Dr. <%= doctor.firstName %> <%= doctor.lastName %> (<%= doctor.specialization %>)
                                        </option>
                                    <% }); %>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="diagnosis" class="form-label">Diagnosis</label>
                                <textarea class="form-control" id="diagnosis" name="diagnosis" rows="4" required><%= medicalRecord.diagnosis %></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="prescription" class="form-label">Prescription</label>
                                <textarea class="form-control" id="prescription" name="prescription" rows="3"><%= medicalRecord.prescription %></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="followUpDate" class="form-label">Follow-up Date (if needed)</label>
                                <input type="date" class="form-control" id="followUpDate" name="followUpDate" value="<%= medicalRecord.followUpDate ? medicalRecord.followUpDate.toISOString().split('T')[0] : '' %>">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notes Section -->
                    <div class="mb-4">
                        <label for="notes" class="form-label">Additional Notes</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3"><%= medicalRecord.notes %></textarea>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="/medical-records/<%= medicalRecord.id %>" class="btn btn-secondary me-md-2">Cancel</a>
                        <button type="submit" class="btn btn-primary">Update Medical Record</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>