<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">
            <% if (locals.settings && settings.favicon_path) { %>
                <img src="<%= settings.favicon_path %>" alt="<%= settings.medical_name %>" style="width: 40px; height: 40px;">
            <% } else { %>
                <i class="fas fa-hospital-alt me-2"></i>
            <% } %>
            
            
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <% if ((locals.isFeatureVisible('Billing')) || 
                      (locals.isFeatureVisible('Pay Bill'))) { %>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle <%= (title === 'Billing' || title === 'Due Bill') ? 'active' : '' %>" href="#" id="invoiceDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-file-invoice-dollar me-1"></i>Invoice
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="invoiceDropdown">
                        <% if (locals.isFeatureVisible('Billing')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Billing' ? 'active' : '' %>" href="/billing">
                                <i class="fas fa-file-invoice-dollar me-1"></i>Billing
                            </a>
                        </li>
                        <% } %>
                        <% if (locals.isFeatureVisible('Pay Bill')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Due Bill' ? 'active' : '' %>" href="/reports/billing/due">
                                <i class="fas fa-file-invoice-dollar me-1"></i>Due Bill
                            </a>
                        </li>
                        <% } %>
                    </ul>
                </li>
                <% } %>
                
                <% if ((locals.isFeatureVisible('Patients')) || 
                      (locals.isFeatureVisible('Doctors'))) { %>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle <%= (title === 'Patients' || title === 'Doctors') ? 'active' : '' %>" href="#" id="peopleDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-users me-1"></i>People
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="peopleDropdown">
                        <% if (locals.isFeatureVisible('Patients')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Patients' ? 'active' : '' %>" href="/patients">
                                <i class="fas fa-user-injured me-1"></i>Patients
                            </a>
                        </li>
                        <% } %>
                        <% if (locals.isFeatureVisible('Doctors')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Doctors' ? 'active' : '' %>" href="/doctors">
                                <i class="fas fa-user-md me-1"></i>Doctors
                            </a>
                        </li>
                        <% } %>
                    </ul>
                </li>
                <% } %>
                
                <% if ((locals.isFeatureVisible('Appointments')) || 
                      (locals.isFeatureVisible('Tests')) ||
                      (locals.isFeatureVisible('Cabins'))) { %>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle <%= (title === 'Appointments' || title === 'Test Requisitions' || title === 'Cabin Bookings') ? 'active' : '' %>" href="#" id="bookingsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-calendar-alt me-1"></i>Bookings
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="bookingsDropdown">
                        <% if (locals.isFeatureVisible('Appointments')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Appointments' ? 'active' : '' %>" href="/appointments">
                                <i class="fas fa-calendar-check me-1"></i>Appointments
                            </a>
                        </li>
                        <% } %>
                        <% if (locals.isFeatureVisible('Tests')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Test Requisitions' ? 'active' : '' %>" href="/tests/requisitions">
                                <i class="fas fa-clipboard-list me-1"></i>Test Requisitions
                            </a>
                        </li>
                        <% } %>
                        <% if (locals.isFeatureVisible('Cabins')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Cabin Bookings' ? 'active' : '' %>" href="/cabins/bookings/all">
                                <i class="fas fa-bed me-1"></i>Cabin Bookings
                            </a>
                        </li>
                        <% } %>
                    </ul>
                </li>
                <% } %>
                
                <% if ((locals.isFeatureVisible('Tests')) || 
                      (locals.isFeatureVisible('Cabins'))) { %>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle <%= (title === 'Tests' || title === 'Cabins') ? 'active' : '' %>" href="#" id="servicesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-hospital-user me-1"></i>Services
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="servicesDropdown">
                        <% if (locals.isFeatureVisible('Tests')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Tests' ? 'active' : '' %>" href="/tests">
                                <i class="fas fa-vial me-1"></i>Tests
                            </a>
                        </li>
                        <% } %>
                        <% if (locals.isFeatureVisible('Cabins')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Cabins' ? 'active' : '' %>" href="/cabins">
                                <i class="fas fa-bed me-1"></i>Cabins
                            </a>
                        </li>
                        <% } %>
                    </ul>
                </li>
                <% } %>
                
                <% if (locals.isFeatureVisible('Reports')) { %>
                <li class="nav-item">
                    <a class="nav-link <%= title === 'Reports' ? 'active' : '' %>" href="/reports">
                        <i class="fas fa-chart-line me-1"></i>Reports
                    </a>
                </li>
                <% } %>
                
                <!-- Marketing Menu -->
                <% if (locals.isFeatureVisible('Marketing')) { %>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle <%= (title === 'Doctor Commissions' || title === 'Referral Dashboard' || title === 'Commission Reports') ? 'active' : '' %>" href="#" id="marketingDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-bullhorn me-1"></i>Marketing
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="marketingDropdown">
                        <% if (locals.isFeatureVisible('Doctor Commissions')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Doctor Commissions' ? 'active' : '' %>" href="/commissions">
                                <i class="fas fa-percentage me-1"></i>Doctor Commissions
                            </a>
                        </li>
                        <% } %>
                    </ul>
                </li>
                <% } %>
                
                <% if ((locals.isFeatureVisible('Add Staff')) || 
                      (locals.isFeatureVisible('View Staff')) ||
                      (locals.isFeatureVisible('Edit Staff')) ||
                      (locals.isFeatureVisible('Delete Staff'))) { %>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle <%= (title === 'Register User' || title === 'Staff List' || title === 'Edit Staff') ? 'active' : '' %>" href="#" id="hrmDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-users-cog me-1"></i>HRM
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="hrmDropdown">
                        <% if (locals.isFeatureVisible('Add Staff')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Register User' ? 'active' : '' %>" href="/register">
                                <i class="fas fa-user-plus me-1"></i>Add Staff
                            </a>
                        </li>
                        <% } %>
                        <% if (locals.isFeatureVisible('View Staff')) { %>
                        <li>
                            <a class="dropdown-item <%= title === 'Staff List' ? 'active' : '' %>" href="/users">
                                <i class="fas fa-users me-1"></i>Staff List
                            </a>
                        </li>
                        <% } %>
                    </ul>
                </li>
                <% } %>
                
                <% if (locals.user?.role === 'softadmin' || locals.isFeatureVisible('Settings')) { %>
                <li class="nav-item">
                    <a class="nav-link <%= title === 'Settings' ? 'active' : '' %>" href="/settings">
                        <i class="fas fa-cog me-1"></i>Settings
                    </a>
                </li>
                <% } %>
            </ul>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user-shield me-1"></i><%= user.role.toUpperCase() %>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li>
                            <a class="dropdown-item <%= title === 'My Profile' ? 'active' : '' %>" href="/profile">
                                <i class="fas fa-id-card me-1"></i>My Profile
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" href="/logout">
                                <i class="fas fa-sign-out-alt me-1"></i>Logout
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>